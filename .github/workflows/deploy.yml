name: deploy app
on: 
  push:
    branches:
      - development
  
jobs:
  build:
    runs-on: ubuntu-18.04
    steps:
      - name: checkout code #get repo file
        uses: actions/checkout@master
        with:
          path: portfolio
      
      - name: checkout node
        uses: actions/setup-node@master
        with:
          node-version: 12.18.3

      - name: git config
        env:
          USER_NAME: ${{ github.event.pusher.name }}
          USER_EMAIL: ${{ github.event.pusher.email }}
        run: |
          git config --global user.email "$USER_EMAIL"
          git config --global user.name "$USER_NAME"

      - name: install key
        env:
          GH_ACTION_DEPLOY_KEY: ${{ secrets.GH_ACTION_DEPLOY_KEY }}
        run: |
          mkdir -p ~/.ssh/
          echo "$GH_ACTION_DEPLOY_KEY" > ~/.ssh/id_rsa
          chmod 600 ~/.ssh/id_rsa
          ssh-keyscan github.com >> ~/.ssh/known_hosts

      - name: clone data
        run: |
          git clone https://github.com/seo2im/portfolio.git deploy

      - name: npm install #set dependency
        run: |
          cd portfolio
          npm install
          npm run build
        
      - name: move to deploy
        run: |
          ls
          rm -rf ./deploy/*
          mv ./portfolio/* ./deploy

      - name: push
        run: |
          git add .
          git commit -m "feat:deployment"
          git push origin master

